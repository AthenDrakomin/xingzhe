import{u as A,j as e}from"./index-CRUGRQFH.js";import{r as g}from"./vendor-KfUPlHYY.js";import{u as E,m as x}from"./api-zHEHMmkZ.js";import{P as v}from"./permissions-DiR0R8A_.js";const R=()=>{const{data:a,error:c,isLoading:o,mutate:i}=E("media",x.getAll);return{media:a||[],isLoading:o,isError:c,mutate:i}},P=()=>{const{media:a,isLoading:c,isError:o,mutate:i}=R(),{user:l}=A(),[u,h]=g.useState(!1),[f,m]=g.useState(null),p=v.canManageMedia(l),j=v.canDeleteMedia(l),N=async s=>{const t=s.target.files;if(!(!t||!l)){if(!p){m("æ‚¨æ²¡æœ‰æƒé™ä¸Šä¼ æ–‡ä»¶");return}try{h(!0),m(null);for(let r=0;r<t.length;r++){const n=t[r],y=await new Promise((M,D)=>{const d=new FileReader;d.onload=()=>M(d.result),d.onerror=D,d.readAsDataURL(n)}),w={filename:n.name,url:y,mimeType:n.type,size:n.size,uploadedBy:l.id,createdAt:new Date};await x.create(w)}i(),s.target&&(s.target.value="")}catch(r){console.error("ä¸Šä¼ å¤±è´¥:",r),m("ä¸Šä¼ å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•")}finally{h(!1)}}},b=async s=>{if(window.confirm("ç¡®å®šè¦åˆ é™¤è¿™ä¸ªåª’ä½“æ–‡ä»¶å—ï¼Ÿ")){if(!j){alert("æ‚¨æ²¡æœ‰æƒé™åˆ é™¤æ–‡ä»¶");return}try{await x.delete(s),i()}catch(t){console.error("åˆ é™¤å¤±è´¥:",t),alert("åˆ é™¤å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•")}}};return c?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"text-slate-400",children:"åŠ è½½ä¸­..."})}):o?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"text-red-400",children:"åŠ è½½å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•"})}):e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsx("h1",{className:"text-2xl font-medium text-slate-100",children:"åª’ä½“åº“"}),p&&e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("label",{className:"bg-emerald-700 hover:bg-emerald-600 text-white px-4 py-2 rounded-sm text-sm transition-colors cursor-pointer",children:[u?"ä¸Šä¼ ä¸­...":"ä¸Šä¼ æ–‡ä»¶",e.jsx("input",{type:"file",multiple:!0,onChange:N,disabled:u,className:"hidden",accept:"image/*,.pdf,.doc,.docx"})]})})]}),f&&e.jsx("div",{className:"bg-red-900/30 border border-red-800 text-red-400 px-4 py-3 rounded-sm mb-6",children:f}),a.length===0?e.jsxs("div",{className:"bg-slate-900/30 border border-white/10 rounded-sm p-12 text-center",children:[e.jsx("p",{className:"text-slate-500",children:"æš‚æ— åª’ä½“æ–‡ä»¶"}),e.jsx("p",{className:"text-slate-600 text-sm mt-2",children:'ç‚¹å‡»ä¸Šæ–¹"ä¸Šä¼ æ–‡ä»¶"æŒ‰é’®æ·»åŠ å›¾ç‰‡æˆ–å…¶ä»–åª’ä½“æ–‡ä»¶'})]}):e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4",children:a.map(s=>e.jsxs("div",{className:"bg-slate-900/30 border border-white/10 rounded-sm overflow-hidden group",children:[s.mimeType.startsWith("image/")?e.jsx("div",{className:"aspect-square overflow-hidden",children:e.jsx("img",{src:s.url,alt:s.filename,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"})}):e.jsx("div",{className:"aspect-square flex items-center justify-center bg-slate-800",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl mb-2",children:"ğŸ“„"}),e.jsx("div",{className:"text-xs text-slate-400 truncate px-2",children:s.filename})]})}),e.jsxs("div",{className:"p-2",children:[e.jsx("div",{className:"text-xs text-slate-400 truncate",title:s.filename,children:s.filename}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsxs("span",{className:"text-xs text-slate-500",children:[(s.size/1024).toFixed(1),"KB"]}),j&&e.jsx("button",{onClick:()=>b(s.id),className:"text-red-400 hover:text-red-300 text-xs",children:"åˆ é™¤"})]})]})]},s.id))})]})};export{P as default};
