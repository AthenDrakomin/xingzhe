var C=Object.defineProperty;var D=(o,t,s)=>t in o?C(o,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):o[t]=s;var b=(o,t,s)=>D(o,typeof t!="symbol"?t+"":t,s);import{q as j,c as y,d as u,o as U,g as N,e as S,f as h,w as O,s as M,h as v,i as k,u as q,j as e}from"./index-NxYxU1Bf.js";import{r as x}from"./vendor-KfUPlHYY.js";class f{static async getAllUsers(){try{const t=j(y(u,this.COLLECTION_NAME),U("createdAt","desc"));return(await N(t)).docs.map(a=>{var n,c;const l=a.data();return{id:a.id,...l,createdAt:((n=l.createdAt)==null?void 0:n.toDate())||new Date,lastLoginAt:((c=l.lastLoginAt)==null?void 0:c.toDate())||void 0}})}catch(t){throw console.error("Error fetching users:",t),new Error("Failed to fetch users")}}static async getUserById(t){var s,a;try{const l=await S(h(u,this.COLLECTION_NAME,t));if(l.exists()){const n=l.data();return{id:l.id,...n,createdAt:((s=n.createdAt)==null?void 0:s.toDate())||new Date,lastLoginAt:((a=n.lastLoginAt)==null?void 0:a.toDate())||void 0}}return null}catch(l){throw console.error("Error fetching user:",l),new Error("Failed to fetch user")}}static async getUserByEmail(t){var s,a;try{const l=j(y(u,this.COLLECTION_NAME),O("email","==",t)),n=await N(l);if(!n.empty){const c=n.docs[0],d=c.data();return{id:c.id,...d,createdAt:((s=d.createdAt)==null?void 0:s.toDate())||new Date,lastLoginAt:((a=d.lastLoginAt)==null?void 0:a.toDate())||void 0}}return null}catch(l){throw console.error("Error fetching user by email:",l),new Error("Failed to fetch user by email")}}static async saveUser(t,s){try{const a=h(u,this.COLLECTION_NAME,s);await M(a,{...t,createdAt:t.createdAt||new Date,lastLoginAt:t.lastLoginAt||null},{merge:!0})}catch(a){throw console.error("Error saving user:",a),new Error("Failed to save user")}}static async updateUser(t,s){try{const a=h(u,this.COLLECTION_NAME,t);await v(a,s)}catch(a){throw console.error("Error updating user:",a),new Error("Failed to update user")}}static async deleteUser(t){try{const s=h(u,this.COLLECTION_NAME,t);await k(s)}catch(s){throw console.error("Error deleting user:",s),new Error("Failed to delete user")}}static async updateLastLogin(t){try{const s=h(u,this.COLLECTION_NAME,t);await v(s,{lastLoginAt:new Date})}catch(s){throw console.error("Error updating last login time:",s),new Error("Failed to update last login time")}}}b(f,"COLLECTION_NAME","users");const R=()=>{const{user:o}=q(),[t,s]=x.useState([]),[a,l]=x.useState(!0),[n,c]=x.useState(null),[d,p]=x.useState(null),[g,m]=x.useState(!1);x.useEffect(()=>{(async()=>{try{l(!0);const i=await f.getAllUsers();s(i),c(null)}catch(i){console.error("Error fetching users:",i),c("获取用户列表失败")}finally{l(!1)}})()},[]);const E=r=>{p(r),m(!0)},w=()=>{m(!1),p(null)},A=async r=>{if(d)try{await f.updateUser(d.id,r),s(t.map(i=>i.id===d.id?{...i,...r}:i)),w()}catch(i){console.error("Error updating user:",i),c("更新用户失败")}},L=async r=>{if(window.confirm("确定要删除这个用户吗？"))try{await f.deleteUser(r),s(t.filter(i=>i.id!==r))}catch(i){console.error("Error deleting user:",i),c("删除用户失败")}};return a?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"text-slate-400",children:"加载中..."})}):e.jsxs("div",{className:"bg-slate-900/30 border border-white/10 rounded-sm p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsx("h2",{className:"text-xl font-medium text-slate-100",children:"用户管理"})}),n&&e.jsx("div",{className:"bg-red-900/30 border border-red-800 text-red-400 px-4 py-3 rounded-sm mb-6",children:n}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-white/10",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-slate-400 uppercase tracking-wider",children:"用户"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-slate-400 uppercase tracking-wider",children:"邮箱"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-slate-400 uppercase tracking-wider",children:"角色"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-slate-400 uppercase tracking-wider",children:"注册时间"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-slate-400 uppercase tracking-wider",children:"操作"})]})}),e.jsx("tbody",{className:"divide-y divide-white/10",children:t.map(r=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[r.avatar?e.jsx("img",{src:r.avatar,alt:r.name,className:"h-8 w-8 rounded-full mr-3"}):e.jsx("div",{className:"h-8 w-8 rounded-full bg-slate-700 mr-3 flex items-center justify-center",children:e.jsx("span",{className:"text-slate-400 text-sm",children:r.name.charAt(0)})}),e.jsx("div",{children:e.jsx("div",{className:"text-sm font-medium text-slate-100",children:r.name})})]})}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-sm text-slate-400",children:r.email}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${r.role==="admin"?"bg-emerald-900/50 text-emerald-400":r.role==="editor"?"bg-blue-900/50 text-blue-400":"bg-slate-700 text-slate-300"}`,children:r.role==="admin"?"管理员":r.role==="editor"?"编辑者":"作者"})}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-sm text-slate-400",children:r.createdAt.toLocaleDateString()}),e.jsxs("td",{className:"px-4 py-4 whitespace-nowrap text-sm font-medium",children:[e.jsx("button",{onClick:()=>E(r),className:"text-emerald-400 hover:text-emerald-300 mr-3",children:"编辑"}),(o==null?void 0:o.id)!==r.id&&e.jsx("button",{onClick:()=>L(r.id),className:"text-red-400 hover:text-red-300",children:"删除"})]})]},r.id))})]})}),g&&d&&e.jsx(I,{user:d,onSave:A,onClose:w})]})},I=({user:o,onSave:t,onClose:s})=>{const[a,l]=x.useState(o.name),[n,c]=x.useState(o.role),[d,p]=x.useState(o.avatar||""),g=m=>{m.preventDefault(),t({name:a,role:n,avatar:d||void 0})};return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-slate-900 border border-white/10 rounded-sm p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-lg font-medium text-slate-100 mb-4",children:"编辑用户"}),e.jsxs("form",{onSubmit:g,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-400 mb-2",children:"姓名"}),e.jsx("input",{type:"text",value:a,onChange:m=>l(m.target.value),className:"w-full bg-slate-800 border border-white/10 rounded-sm px-4 py-2 text-slate-100 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-400 mb-2",children:"角色"}),e.jsxs("select",{value:n,onChange:m=>c(m.target.value),className:"w-full bg-slate-800 border border-white/10 rounded-sm px-4 py-2 text-slate-100 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent",children:[e.jsx("option",{value:"author",children:"作者"}),e.jsx("option",{value:"editor",children:"编辑者"}),e.jsx("option",{value:"admin",children:"管理员"})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-400 mb-2",children:"头像URL"}),e.jsx("input",{type:"text",value:d,onChange:m=>p(m.target.value),className:"w-full bg-slate-800 border border-white/10 rounded-sm px-4 py-2 text-slate-100 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent",placeholder:"https://example.com/avatar.jpg"})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:s,className:"px-4 py-2 text-sm text-slate-400 hover:text-white",children:"取消"}),e.jsx("button",{type:"submit",className:"px-4 py-2 text-sm bg-emerald-700 hover:bg-emerald-600 text-white rounded-sm",children:"保存"})]})]})]})})};export{R as default};
