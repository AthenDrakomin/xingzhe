import{b as E,a as S,u as A,j as e}from"./index-CRUGRQFH.js";import{r as i}from"./vendor-KfUPlHYY.js";import{a as F}from"./useArticles-Bj619Mu6.js";import{a as j}from"./api-zHEHMmkZ.js";import{P as y}from"./permissions-DiR0R8A_.js";const U=()=>{const{id:d}=E(),x=S(),{user:o}=A(),{article:a,isLoading:N}=F(d||""),r=!!d,w=r?y.canUpdateArticle(o,a==null?void 0:a.author.id):y.canCreateArticle(o),[s,m]=i.useState({title:"",content:"",excerpt:"",coverImage:"",tags:[],category:"",status:"draft"}),[u,h]=i.useState(""),[g,b]=i.useState(!1),[f,c]=i.useState(null);if(i.useEffect(()=>{r&&a&&m({title:a.title,content:a.content,excerpt:a.excerpt,coverImage:a.coverImage||"",tags:a.tags||[],category:a.category||"",status:a.status})},[r,a]),r&&N)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"text-slate-400",children:"加载中..."})});const l=t=>{const{name:n,value:p}=t.target;m(I=>({...I,[n]:p}))},v=()=>{u.trim()&&!s.tags.includes(u.trim())&&(m(t=>({...t,tags:[...t.tags,u.trim()]})),h(""))},k=t=>{m(n=>({...n,tags:n.tags.filter(p=>p!==t)}))},C=async t=>{if(t.preventDefault(),!s.title.trim()){c("请输入文章标题");return}if(!s.content.trim()){c("请输入文章内容");return}if(!w){c("您没有权限执行此操作");return}try{if(b(!0),c(null),r&&d)await j.update(d,s);else{if(!o)throw new Error("用户未登录");await j.create(s,{id:o.id,name:o.name})}x("/cms/articles")}catch(n){console.error("保存失败:",n),c("保存失败，请稍后重试")}finally{b(!1)}};return e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsx("h1",{className:"text-2xl font-medium text-slate-100",children:r?"编辑文章":"新建文章"}),e.jsx("button",{onClick:()=>x("/cms/articles"),className:"text-slate-400 hover:text-white text-sm",children:"返回列表"})]}),f&&e.jsx("div",{className:"bg-red-900/30 border border-red-800 text-red-400 px-4 py-3 rounded-sm mb-6",children:f}),e.jsxs("form",{onSubmit:C,className:"bg-slate-900/30 border border-white/10 rounded-sm p-6",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"title",className:"block text-sm font-medium text-slate-400 mb-2",children:"标题 *"}),e.jsx("input",{id:"title",name:"title",type:"text",value:s.title,onChange:l,className:"w-full bg-slate-800 border border-white/10 rounded-sm px-4 py-2 text-slate-100 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent",placeholder:"输入文章标题"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"excerpt",className:"block text-sm font-medium text-slate-400 mb-2",children:"摘要"}),e.jsx("textarea",{id:"excerpt",name:"excerpt",value:s.excerpt,onChange:l,rows:3,className:"w-full bg-slate-800 border border-white/10 rounded-sm px-4 py-2 text-slate-100 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent",placeholder:"输入文章摘要"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"content",className:"block text-sm font-medium text-slate-400 mb-2",children:"内容 *"}),e.jsx("textarea",{id:"content",name:"content",value:s.content,onChange:l,rows:15,className:"w-full bg-slate-800 border border-white/10 rounded-sm px-4 py-2 text-slate-100 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent font-mono text-sm",placeholder:"输入文章内容（支持Markdown语法）"})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"coverImage",className:"block text-sm font-medium text-slate-400 mb-2",children:"封面图片URL"}),e.jsx("input",{id:"coverImage",name:"coverImage",type:"text",value:s.coverImage,onChange:l,className:"w-full bg-slate-800 border border-white/10 rounded-sm px-4 py-2 text-slate-100 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent",placeholder:"https://example.com/image.jpg"}),s.coverImage&&e.jsx("div",{className:"mt-2",children:e.jsx("img",{src:s.coverImage,alt:"封面预览",className:"w-full h-32 object-cover rounded-sm"})})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"category",className:"block text-sm font-medium text-slate-400 mb-2",children:"分类"}),e.jsx("input",{id:"category",name:"category",type:"text",value:s.category,onChange:l,className:"w-full bg-slate-800 border border-white/10 rounded-sm px-4 py-2 text-slate-100 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent",placeholder:"输入分类名称"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-400 mb-2",children:"标签"}),e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx("input",{type:"text",value:u,onChange:t=>h(t.target.value),onKeyDown:t=>t.key==="Enter"&&(t.preventDefault(),v()),className:"flex-1 bg-slate-800 border border-white/10 rounded-sm px-4 py-2 text-slate-100 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent",placeholder:"输入标签并按回车添加"}),e.jsx("button",{type:"button",onClick:v,className:"bg-slate-700 hover:bg-slate-600 text-slate-300 px-4 py-2 rounded-sm text-sm transition-colors",children:"添加"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.tags.map(t=>e.jsxs("span",{className:"inline-flex items-center gap-1 bg-slate-800 text-slate-300 px-2 py-1 rounded-sm text-sm",children:[t,e.jsx("button",{type:"button",onClick:()=>k(t),className:"text-slate-500 hover:text-white",children:"×"})]},t))})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"status",className:"block text-sm font-medium text-slate-400 mb-2",children:"状态"}),e.jsxs("select",{id:"status",name:"status",value:s.status,onChange:l,className:"w-full bg-slate-800 border border-white/10 rounded-sm px-4 py-2 text-slate-100 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent",children:[e.jsx("option",{value:"draft",children:"草稿"}),e.jsx("option",{value:"published",children:"已发布"}),e.jsx("option",{value:"archived",children:"已归档"})]})]})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-4 mt-8 pt-6 border-t border-white/10",children:[e.jsx("button",{type:"button",onClick:()=>x("/cms/articles"),className:"text-slate-400 hover:text-white px-4 py-2 text-sm",children:"取消"}),e.jsx("button",{type:"submit",disabled:g,className:"bg-emerald-700 hover:bg-emerald-600 text-white px-6 py-2 rounded-sm text-sm transition-colors disabled:opacity-50",children:g?"保存中...":"保存文章"})]})]})]})};export{U as default};
