import{b as w,a as C,u as k,j as e}from"./index-CRUGRQFH.js";import{r as i}from"./vendor-KfUPlHYY.js";import{a as E}from"./usePages-DO7PhUtR.js";import{p as f}from"./api-zHEHMmkZ.js";import{P as g}from"./permissions-DiR0R8A_.js";const A=()=>{const{id:l}=w(),d=C(),{user:m}=k(),{page:s,isLoading:j}=E(l||""),r=!!l,v=r?g.canUpdatePage(m):g.canCreatePage(m),[t,u]=i.useState({title:"",content:"",order:0,status:"draft"}),[x,p]=i.useState(!1),[h,a]=i.useState(null);if(i.useEffect(()=>{r&&s&&u({title:s.title,content:s.content,order:s.order,status:s.status})},[r,s]),r&&j)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"text-slate-400",children:"加载中..."})});const n=c=>{const{name:o,value:b}=c.target;u(y=>({...y,[o]:o==="order"?parseInt(b)||0:b}))},N=async c=>{if(c.preventDefault(),!t.title.trim()){a("请输入页面标题");return}if(!t.content.trim()){a("请输入页面内容");return}if(!v){a("您没有权限执行此操作");return}try{p(!0),a(null),r&&l?await f.update(l,t):await f.create(t),d("/cms/pages")}catch(o){console.error("保存失败:",o),a("保存失败，请稍后重试")}finally{p(!1)}};return e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsx("h1",{className:"text-2xl font-medium text-slate-100",children:r?"编辑页面":"新建页面"}),e.jsx("button",{onClick:()=>d("/cms/pages"),className:"text-slate-400 hover:text-white text-sm",children:"返回列表"})]}),h&&e.jsx("div",{className:"bg-red-900/30 border border-red-800 text-red-400 px-4 py-3 rounded-sm mb-6",children:h}),e.jsxs("form",{onSubmit:N,className:"bg-slate-900/30 border border-white/10 rounded-sm p-6",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"title",className:"block text-sm font-medium text-slate-400 mb-2",children:"标题 *"}),e.jsx("input",{id:"title",name:"title",type:"text",value:t.title,onChange:n,className:"w-full bg-slate-800 border border-white/10 rounded-sm px-4 py-2 text-slate-100 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent",placeholder:"输入页面标题"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"content",className:"block text-sm font-medium text-slate-400 mb-2",children:"内容 *"}),e.jsx("textarea",{id:"content",name:"content",value:t.content,onChange:n,rows:20,className:"w-full bg-slate-800 border border-white/10 rounded-sm px-4 py-2 text-slate-100 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent font-mono text-sm",placeholder:"输入页面内容（支持Markdown语法）"})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"slug",className:"block text-sm font-medium text-slate-400 mb-2",children:"路径"}),e.jsx("input",{id:"slug",name:"slug",type:"text",value:t.title.toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,""),readOnly:!0,className:"w-full bg-slate-800 border border-white/10 rounded-sm px-4 py-2 text-slate-100 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent"}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"基于标题自动生成，用于页面URL"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"order",className:"block text-sm font-medium text-slate-400 mb-2",children:"排序"}),e.jsx("input",{id:"order",name:"order",type:"number",value:t.order,onChange:n,className:"w-full bg-slate-800 border border-white/10 rounded-sm px-4 py-2 text-slate-100 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent",placeholder:"0"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"status",className:"block text-sm font-medium text-slate-400 mb-2",children:"状态"}),e.jsxs("select",{id:"status",name:"status",value:t.status,onChange:n,className:"w-full bg-slate-800 border border-white/10 rounded-sm px-4 py-2 text-slate-100 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent",children:[e.jsx("option",{value:"draft",children:"草稿"}),e.jsx("option",{value:"published",children:"已发布"})]})]})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-4 mt-8 pt-6 border-t border-white/10",children:[e.jsx("button",{type:"button",onClick:()=>d("/cms/pages"),className:"text-slate-400 hover:text-white px-4 py-2 text-sm",children:"取消"}),e.jsx("button",{type:"submit",disabled:x,className:"bg-emerald-700 hover:bg-emerald-600 text-white px-6 py-2 rounded-sm text-sm transition-colors disabled:opacity-50",children:x?"保存中...":"保存页面"})]})]})]})};export{A as default};
